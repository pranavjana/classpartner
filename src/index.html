<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ClassPartner Overlay</title>
    <link rel="stylesheet" href="index.css" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; style-src 'self' 'unsafe-inline';"
    />
  </head>
  <body>
    <div class="overlay-root">
      <header class="overlay-header" id="header-bar">
        <div class="header-drag">
          <div class="brand-mark" aria-hidden="true"></div>
          <span class="brand-name">ClassPartner</span>
        </div>
        <div class="window-buttons" role="group" aria-label="Window controls">
          <button id="minimize-btn" class="window-btn" aria-label="Minimize">
            <span aria-hidden="true"></span>
          </button>
          <button id="maximize-btn" class="window-btn" data-state="restored" aria-label="Toggle maximize">
            <span class="maximize-icon" aria-hidden="true"></span>
          </button>
          <button id="close-btn" class="window-btn window-btn-destructive" aria-label="Close">
            <span aria-hidden="true"></span>
          </button>
        </div>
      </header>

      <section class="control-strip">
        <div class="control-group">
          <button class="record-toggle" id="record-btn">
            <div class="record-indicator" id="record-icon"></div>
            <span id="record-text">Start</span>
          </button>
          <button class="icon-btn" id="download-btn" title="Download transcript">
            <svg viewBox="0 0 14 14" aria-hidden="true">
              <path d="M7 1v8M7 9l-3-3m3 3l3-3" />
              <path d="M1 11h12" />
            </svg>
          </button>
          <button class="icon-btn" id="settings-btn" title="Overlay settings">
            <svg viewBox="0 0 12 12" aria-hidden="true">
              <path
                d="M6 7.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm4.5-1.5c0 .3-.03.59-.08.87l1.12.76c.09.06.12.17.06.27l-1 1.7c-.06.1-.17.13-.27.09l-1.29-.54a3.2 3.2 0 0 1-.78.47l-.19 1.4c-.01.11-.11.19-.22.19h-2c-.11 0-.21-.08-.22-.19l-.19-1.4a3.2 3.2 0 0 1-.78-.47l-1.29.54c-.1.04-.21.01-.27-.09l-1-1.7a.2.2 0 0 1 .06-.27l1.12-.76A4 4 0 0 1 3.2 6c0-.3.03-.59.08-.87l-1.12-.76a.2.2 0 0 1-.06-.27l1-1.7c.06-.1.17-.13.27-.09l1.29.54c.25-.2.51-.36.78-.47l.19-1.4c.01-.11.11-.19.22-.19h2c.11 0 .21.08.22.19l.19 1.4c.27.11.53.27.78.47l1.29-.54c.1-.04.21-.01.27.09l1 1.7c.06.1.03.21-.06.27l-1.12.76c.05.28.08.57.08.87Z"
              />
            </svg>
          </button>
        </div>

        <div class="control-group control-group-lost">
          <button class="lost-trigger" id="lost-btn" title="Drop a marker and get a recap (Cmd/Ctrl + L)">
            <span class="lost-trigger-dot" aria-hidden="true"></span>
            <span class="lost-trigger-text">I'm lost</span>
            <kbd class="lost-trigger-shortcut">⌘L</kbd>
          </button>
        </div>

        <div class="control-separator" aria-hidden="true"></div>

        <div class="control-group control-group-mic" id="mic-booster">
          <label for="mic-gain-slider">Mic</label>
          <input
            type="range"
            id="mic-gain-slider"
            min="1"
            max="5"
            step="0.1"
            value="1"
          />
          <span id="gain-value">1.0x</span>
        </div>

        <div class="control-group status-group">
          <div class="connection-status" id="connection-status">
            <span class="status-dot" id="status-dot" aria-hidden="true"></span>
            <span class="status-text" id="status-text">Disconnected</span>
          </div>
          <div class="segment-counter hidden" id="segment-counter">
            <span id="segment-count-text">0 segments</span>
          </div>
        </div>
      </section>

      <main class="overlay-body">
        <div class="overlay-main-content two-column" id="main-content">
          <div class="primary-column" id="main-column">
          <section class="panel transcript-panel collapsible" id="transcript-panel">
          <header class="panel-header">
            <div class="panel-title">
              <span>Live transcript</span>
              <div class="recording-pill hidden" id="recording-indicator">
                <span class="pill-dot" aria-hidden="true"></span>
                <span>Recording</span>
              </div>
            </div>
            <div class="audio-level-container hidden" id="audio-level-container">
              <div class="audio-level-bar">
                <div class="audio-level-fill" id="audio-level-fill"></div>
              </div>
              <span class="audio-level-text" id="audio-level-text">0%</span>
            </div>
            <button class="panel-toggle" id="transcript-toggle" title="Toggle transcript panel">
              <svg viewBox="0 0 14 14" aria-hidden="true">
                <path d="M7 1v8M7 9l-3-3m3 3l3-3" />
              </svg>
            </button>
          </header>

          <div class="panel-content">
            <div class="transcript-container">
            <div class="transcript-display" id="transcript-display">
              <div class="interim-text" id="interim-text"></div>
              <div class="final-text" id="final-text">
                <div class="placeholder-text" id="placeholder-text">
                  Ready for transcription.<br />
                  <small>Press the record button or use Ctrl + Shift + T to toggle the overlay.</small>
                </div>
              </div>
            </div>
            <div class="transcript-controls">
              <button class="transcript-control-btn" id="scroll-to-bottom" title="Scroll to bottom">
                <svg viewBox="0 0 14 14" aria-hidden="true">
                  <path d="M7 1v8M7 9l-3-3m3 3l3-3" />
                </svg>
              </button>
              <button class="transcript-control-btn" id="clear-transcript" title="Clear transcript">
                <svg viewBox="0 0 14 14" aria-hidden="true">
                  <path d="M3 3l8 8M11 3l-8 8" />
                </svg>
              </button>
            </div>
          </div>
        </section>

        <section class="panel qa-card" id="qa-card">
          <header class="panel-header">
            <div class="panel-title">
              <span>Ask the lecture</span>
            </div>
            <span class="qa-hint">Shift + Enter to submit</span>
          </header>
          <div class="panel-content">
            <div class="qa-input-row">
              <input
                id="qa-input"
                class="qa-input"
                type="text"
                placeholder="Ask about what was just said..."
                autocomplete="off"
              />
              <button id="qa-btn" class="qa-submit">Ask</button>
            </div>
            <div id="qa-results" class="qa-results">
              <div class="qa-muted">Ask about recent moments to see AI answers and snippets.</div>
            </div>
          </div>
        </section>
        </div>

        <aside class="panel insights-panel collapsible" id="ai-panel">
          <header class="panel-header">
            <div class="panel-title">
              <span>AI insights</span>
            </div>
            <div class="ai-status" id="ai-status">
              <span class="ai-status-dot" id="ai-status-dot" aria-hidden="true"></span>
              <span id="ai-status-text">Initializing...</span>
            </div>
            <button class="panel-toggle" id="ai-toggle" title="Toggle AI insights panel">
              <svg viewBox="0 0 14 14" aria-hidden="true">
                <path d="M7 1v8M7 9l-3-3m3 3l3-3" />
              </svg>
            </button>
          </header>

          <div class="panel-content">
            <div class="insights-container">
              <div class="panel-section">
                <div class="section-header">
                  <h3>Summary</h3>
                </div>
                <div class="section-body" id="ai-summary">Waiting for conversation...</div>
              </div>

              <div class="panel-section">
                <div class="section-header">
                  <h3>Action items</h3>
                </div>
                <ul class="section-list" id="ai-actions">
                  <li class="placeholder">No action items detected</li>
                </ul>
              </div>

              <div class="panel-section">
                <div class="section-header">
                  <h3>Keywords</h3>
                </div>
                <div class="keyword-grid" id="ai-keywords">
                  <span class="keyword-chip placeholder">No keywords yet</span>
                </div>
              </div>

              <div class="panel-section lost-recaps-section">
                <div class="section-header lost-recaps-header">
                  <h3>Recap coach</h3>
                  <span class="lost-status-pill" id="lost-status-pill">Ready</span>
                </div>
                <div class="lost-recap-list" id="lost-recap-list">
                  <div class="lost-empty-state">
                    Tap “I’m lost” to drop a marker. We’ll recap the last few minutes without pausing transcription.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </aside>
        </div>
      </main>

      <!-- Floating Lost Mode Panel -->
      <section class="panel lost-panel floating-panel" id="lost-panel">
        <header class="panel-header">
          <div class="panel-title">
            <span>I'm lost</span>
            <span class="lost-status-pill" id="lost-status-pill">Ready</span>
          </div>
          <button class="panel-toggle" id="lost-panel-toggle" title="Toggle lost mode panel">
            <svg viewBox="0 0 14 14" aria-hidden="true">
              <path d="M7 1v8M7 9l-3-3m3 3l3-3" />
            </svg>
          </button>
        </header>

        <div class="lost-content">
          <div class="lost-timeline" id="lost-timeline" aria-live="polite">
            <div class="lost-timeline-empty">Lost markers will appear here.</div>
          </div>
          <div class="lost-recap-list" id="lost-recap-list">
            <div class="lost-empty-state">
              Tap "I'm lost" to drop a marker. We'll recap the last few minutes without pausing transcription.
            </div>
          </div>
        </div>
      </section>

    </div>

    <div class="context-menu" id="context-menu">
      <button class="context-menu-item" id="toggle-always-on-top" type="button">
        <span>Always on Top</span>
        <span class="check-mark" id="always-on-top-check">✓</span>
      </button>
    </div>

    <div class="resize-handle resize-handle-bottom" id="resize-bottom" aria-hidden="true"></div>
    <div class="resize-handle resize-handle-right" id="resize-right" aria-hidden="true"></div>
    <div class="resize-handle resize-handle-corner" id="resize-bottom-right" aria-hidden="true"></div>

    <script src="renderer.js"></script>
  </body>
</html>
